def earn(update: Update, context: CallbackContext):
    user = update.effective_user
    rows = db_query('SELECT balance FROM users WHERE user_id=?', (user.id,))
    if not rows:
        update.message.reply_text('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá /start ‡¶ï‡¶∞‡ßÅ‡¶®‡•§')
        return

    # ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶ì‡ßü‡ßá‡¶¨‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
    site_link = f"https://yourdomain.com/earn.html?uid={user.id}"
    update.message.reply_text(
        f"üé• ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®:\n{site_link}\n\n‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶¨‡¶ü ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶¨‡ßá‡•§"
    )here
<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Watch Ads & Earn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="//libtl.com/sdk.js" data-zone="9978537" data-sdk="show_9978537"></script>
  <style>
    body { font-family: Arial; text-align: center; padding: 40px; background: #fafafa; }
    button { background: #0088cc; color: white; padding: 15px 25px; border: none; border-radius: 8px; font-size: 18px; }
  </style>
</head>
<body>
  <h2>üé¨ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
  <p>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
  <button onclick="startAd()">üëâ Watch Ad</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const uid = urlParams.get("uid");

    function startAd() {
      show_9978537('pop').then(() => {
          alert("‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¶‡ßá‡¶ñ‡ßá‡¶õ‡ßá‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶¨‡ßá‡•§");
          // Telegram ‡¶¨‡¶ü‡ßá API ‡¶ï‡¶≤ (simple webhook call)
          fetch(`https://your-server.com/reward?uid=${uid}`)
      }).catch(e => {
          alert("‚ùå ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
      });
    }
  </script>
</body>
</html>
from flask import Flask, request
app = Flask(__name__)

@app.route("/reward")
def reward_user():
    uid = request.args.get("uid")
    if not uid:
        return "missing uid", 400
    now = datetime.utcnow().isoformat()
    amount = 3  # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
    db_execute('UPDATE users SET balance = balance + ? WHERE user_id=?', (amount, uid))
    db_execute('INSERT INTO earnings (user_id, amount, reason, created_at) VALUES (?,?,?,?)',
               (uid, amount, 'watched ad', now))
    return "ok"

if __name__ == "__main__":
    from threading import Thread
    Thread(target=main).start()
    app.run(host="0.0.0.0", port=8000)

